(()=>{var we=Object.defineProperty;var te=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var ne=(d,a,u)=>a in d?we(d,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):d[a]=u,U=(d,a)=>{for(var u in a||(a={}))ye.call(a,u)&&ne(d,u,a[u]);if(te)for(var u of te(a))xe.call(a,u)&&ne(d,u,a[u]);return d};var ie=(d,a,u)=>new Promise((w,l)=>{var x=C=>{try{q(u.next(C))}catch(k){l(k)}},M=C=>{try{q(u.throw(C))}catch(k){l(k)}},q=C=>C.done?w(C.value):Promise.resolve(C.value).then(x,M);q((u=u.apply(d,a)).next())});function ae(d,a,u){let w="";typeof u=="string"&&(w=`<div class="section_ref">${tr.chatview_section_reference}</div>`);let l=`<div class="msg ${d}">${nl2br(a)}${w}</div>`;$("#chatview > .messages").append(l),typeof u=="string"&&$("#chatview > .messages > .msg:last > .section_ref").on("click",function(){console.log("highlight section",u)});let x=$("#chatview > .messages > .msg.user:last")[0];MathJax.Hub.Queue(["Typeset",MathJax.Hub,x])}function se(d,a){ae("system",d,a),$("#chatview > .controls > button").attr("disabled",!1)}function Ce(d){$("#chatview > .controls > button").attr("disabled",!0),ae("user",d)}function oe(d){clearInterval(d),$("#chatview > .messages > .msg.system.pending").remove()}function ke(){return ie(this,null,function*(){let d=$("#chatview > .controls > button").attr("disabled")!=="disabled",a=$("#chatview > .controls > textarea"),u=a.val().trim();if(u!==""&&d){Ce(u),a.val(""),$("#chatview > .messages").append('<div class="msg system pending">.</div>');let w=setInterval(function(){let l=$("#chatview > .messages > .msg.system.pending"),x=l.text().length%3+1;l.text(".".repeat(x))},500);try{yield postChatbotMessage(sess,tracking_session_id,sessdata.user_code,u).then(l=>{if(l.ok)return l.json();throw new Error("Posting the chat message failed.")}).then(function(l){oe(w),se(l.message,l.content_section)})}catch(l){oe(w),se("Sorry, there is currently a problem with the learning assistant service."),console.log("error communicating with the chat service:",l)}}})}$(document).ready(function(){let d="",a=-1,u=!1,w=!1,l=[],x=_.defaults(sessdata.app_config,{summary:!0,reset_button:!0,chatbot:!0}),M=_.defaults(x.summary,!0).valueOf(),q=_.defaults(x.reset_button,!0).valueOf(),C=_.defaults(x.reset_button,!0).valueOf(),k=new Set,R=!1,z=0,ce=["h2","h3","h4","h5","h6","p","ul","ol","div.figure","div.section"].map(e=>".section.level2 > "+e).join(", ");$(ce).each(function(e,t){$(t).prop("id",`mainContentElem-${e}`).addClass("mainContentElem")}),C&&($("#chatview").show(),$("#chatview > .header").on("click",function(){$("#chatview").hasClass("opened")?$("#chatview").removeClass("opened").addClass("closed"):$("#chatview").removeClass("closed").addClass("opened")}),$("#chatview > .controls > button").on("click",ke));let E=function(){let e=[];return{add:function(t,n){e.push({id:t,callback:n})},remove:function(t){e=e.filter(function(n){return t!==n.id})},invoke:function(){for(let t=0;t<e.length;t++)e[t].callback()}}}();function H(e,t){if(typeof t=="undefined"&&(t=!0),l.length===0||(e=e*1,e===a))return;if(a!==-1){let i=$(l[a].jqElement);i.trigger("hide"),i.removeClass("current"),i.trigger("hidden"),$(l[a].jqListElement).removeClass("current")}let n=$(l[e].jqElement);n.trigger("show"),n.addClass("current"),n.trigger("shown"),$(l[e].jqListElement).addClass("current"),a=e,t&&E.invoke(),setTimeout(function(){$(document).scrollTop(0)},0)}function A(e,t){let n=window.location.href.replace(window.location.hash,"");if(window.location=`${n}#${l[e].id}`,t===void 0)$("#learnr-tutorial-content").parent().scrollTop(0);else{let i=$(`#${t}`)[0],c=Math.max(i.offsetTop-i.offsetHeight-60,0);$("#learnr-tutorial-content").parent().scrollTop(c)}I(e-1)}function le(e){J(),A(this.getAttribute("index"))}function re(){$(".topicsList").removeClass("hideFloating")}function J(){$(".topicsList").addClass("hideFloating")}function D(e){K();let t=l[e];if(!t.progressiveReveal)return;let n=!0,i=null;for(let c=0;c<t.sections.length;c++){let r=t.sections[c],s=$(r.jqElement);n?(s.trigger("show"),s.removeClass("hide"),s.trigger("shown"),r.skipped?s.removeClass("showSkip"):(s.addClass("showSkip"),i=s)):(s.trigger("hide"),s.addClass("hide"),s.trigger("hidden")),n=n&&r.skipped}!t.progressiveReveal||n?$(t.jqElement).removeClass("hideActions"):$(t.jqElement).addClass("hideActions"),R&&i&&(z=i.offset().top-28,setTimeout(function(){$("html, body").animate({scrollTop:z},300)},60)),R=!1}function V(e){let t=l[e],n=t.sections.length===0?!t.topicCompleted*100:(1-t.sectionsSkipped/t.sections.length)*100;$(t.jqListElement).css("background-position-y",n+"%")}function F(e){return i18next.language||window.localStorage.i18nextLng||e||"en"}function ue(e){$(this).data("n_clicks",$(this).data("n_clicks")+1);let t=this.getAttribute("data-section-id"),n=-1,i=-1,c,r;if($.each(l,function(s,o){return $.each(o.sections,function(p,g){if(t===g.id)return n=s,i=p,c=o,r=g,!1}),n===-1}),r.exercises.length&&!r.completed&&!r.allowSkip){let s=i18next.t(["text.exercise","exercise"],{count:r.exercises.length,lngs:[F(),"en"]}),o=i18next.t(["text.youmustcomplete","You must complete the"]),p=i18next.t(["text.inthissection","in this section before continuing."]);bootbox.setLocale(F()),bootbox.alert(o+" "+s+" "+p)}else i===c.sections.length-1?n<l.length-1&&A(a+1):R=!0,Y([r.jqElement]),tutorial.skipSection(t)}function de(e){l[a].sections.length===0&&tutorial.skipSection(l[a].id),I(a),A(a+1)}function fe(e){A(a-1)}function pe(){let e=$('<nav id="tutorial-topic" class="topicsList hideFloating" aria-label="topic"></nav>'),t=$('<header class="topicsHeader"></header>'),n=$('<div class="paneCloser"></div>');n.on("click",J),t.append(n),e.append(t);let i=N()?$('<ul class="nav nav-pills" role="menubar" aria-orientation="vertical" aria-label="topic"></ul>'):$('<ul class="nav flex-column" role="menubar" aria-orientation="vertical" aria-label="topic"></ul>');e.append(i),$("#doc-metadata").before(e),K();let c=$(".section.level2");if(c.each(function(r,s){let o={};o.id=$(s).attr("id"),o.exercisesCompleted=0,o.sectionsCompleted=0,o.sectionsSkipped=0,o.topicCompleted=!1,o.jqElement=s,o.jqTitleElement=$(s).children("h2")[0],o.titleText=o.jqTitleElement.innerText;let p=$(s).attr("data-progressive");typeof p!="undefined"&&p!==!1?o.progressiveReveal=p==="true"||p==="TRUE":o.progressiveReveal=u;let g=$(`<li class="topic${N()?"":" nav-item"}" index="${r}"><a href="#${o.id}" class = "nav-link" role="menuitem" tabindex="0">${o.titleText}</a></li>`);g.on("click",le),o.jqListElement=g,$(i).append(g);let h=$('<div class="topicActions"></div>');if(r>0){let v=$('<button class="btn btn-default" data-i18n="button.previoustopic">Previous Topic</button>');v.on("click",fe),h.append(v)}if(r<c.length-1){let v=$('<button class="btn btn-primary" data-i18n="button.nexttopic">Next Topic</button>');v.on("click",de),h.append(v)}$(s).append(h),$(s).on("shown",function(){$(this).is(":visible")&&$(s).children(".section.level3").each(function(f,m){j(m)})}),$(s).on("hidden",function(){$(s).children(".section.level3").each(function(f,m){j(m)})}),o.sections=[],$(s).children(".section.level3").each(function(v,f){if(o.progressiveReveal){let B='data-i18n="button.continue"',y="Continue";f.dataset.continueText&&(y=f.dataset.continueText,B="");let b=$(`<button
              class="btn btn-default skip"
              id="continuebutton-${f.id}"
              data-section-id="${f.id}"
              ${B}
            >${y}</button>`);b.data("n_clicks",0),b.on("click",ue);let ee=$('<div class="exerciseActions"></div>');ee.append(b),$(f).append(ee)}$(f).on("shown",function(){j(f)}),$(f).on("hidden",function(){j(f)});let m={};m.exercises=[],$(f).children(".tutorial-exercise").each(function(B,y){let b={};b.dataLabel=$(y).attr("data-label"),b.completed=!1,b.jqElement=y,m.exercises.push(b)});let T=$(f).attr("data-allow-skip"),L=w;typeof T!="undefined"&&T!==!1&&(L=T="true"),m.id=f.id,m.completed=!1,m.allowSkip=L,m.skipped=!1,m.jqElement=f,o.sections.push(m)}),l.push(o)}),q){let r=$('<li class="resetButton"><a href="#" data-i18n="text.startover">Start Over</a></li>');r.on("click",function(){let s=i18next.t(["text.areyousure","Are you sure you want to start over? (all exercise progress will be reset)"]);bootbox.setLocale(F()),bootbox.confirm(s,function(o){o&&tutorial.startOver()})}),$("#doc-metadata-additional ul").prepend(r)}return e}let Q=new Shiny.InputBinding;$.extend(Q,{find:function(e){return $(e).find(".topicsList")},getValue:function(e){return a===-1?null:l[a].id},setValue:function(e,t){for(let n=0;n<l.length;n++)if(l[n].id===t){H(n,!1);break}},subscribe:function(e,t){E.add(e.id,t)},unsubscribe:function(e){E.remove(e.id)}}),Shiny.inputBindings.register(Q,"learnr.topicMenuInputBinding");let W=new Shiny.InputBinding;$.extend(W,{find:function(e){return $(e).find(".exerciseActions > button.skip")},getId:function(e){return"continuebutton-"+e.getAttribute("data-section-id")},getValue:function(e){return $(e).data("n_clicks")},setValue:function(e,t){let n=$(e).data("n_clicks");t>n&&$(e).trigger("click"),$(e).data("n_clicks",t)},subscribe:function(e,t){$(e).on("click.continueButtonInputBinding",function(n){t(!1)})},unsubscribe:function(e){$(e).off(".continueButtonInputBinding")}}),Shiny.inputBindings.register(W,"learnr.continueButtonInputBinding");function he(){d=$("title")[0].innerText;let e=$("meta[name=progressive]").attr("content");u=e==="true"||e==="TRUE";let t=$("meta[name=allow-skip]").attr("content");w=t==="true"||t==="TRUE";let n=$(`<h1 class="tutorialTitle">${d}</h1>`);n.on("click",re),$(".topics").prepend(n),$(".bandContent.topicsListContainer").append(pe());for(let c=0;c<l.length;c++)D(c);me();function i(){$(".topicsList").css("max-height",window.innerHeight)}i(),window.addEventListener("resize",i)}function me(){$(".footnote-ref").replaceWith(function(){let e=$("<span>");return e.addClass($(this).class),e.append($(this).html()),e}),$(".footnote-back").remove()}function N(){return!window.bootstrap}function ge(){if(N())return;document.querySelectorAll(".btn-xs").forEach(n=>{n.classList.remove("btn-xs"),n.classList.add("btn-sm")}),document.querySelectorAll(".sr-only").forEach(n=>{n.classList.contains("visually-hidden-focusable")||n.classList.add("visually-hidden")});let e={panel:"card","panel-default":"","panel-heading":"card-header","panel-title":"card-title","panel-body":"card-body","panel-footer":"card-footer"},t=document.querySelectorAll(".tutorial-exercise-input, .tutorial-question-container");t.length!==0&&t.forEach(n=>{Object.keys(e).forEach(i=>{let c=[n,...n.querySelectorAll(`.${i}`)];if(!c.length)return;let r=e[i];c.forEach(s=>{!s.classList.contains(i)||(s.classList.remove(i),r!==""&&s.classList.add(r))})})})}function $e(){function e(){let t=window.decodeURIComponent(window.location.hash),n=0;return t.length>0&&$.each(l,function(i,c){if("#"+c.id===t)return n=i,!1}),n}H(e()),I(a-1),window.addEventListener("popstate",function(t){H(e())})}function ve(e){let t=$(e),n=t.hasClass("level2"),i;n?i=t.attr("id"):i=$(t.parents(".section.level2")).attr("id");let c=-1;if($.each(l,function(s,o){if(o.id===i)return c=s,!1}),c===-1){console.log('topic "'+i+'" not found');return}let r=l[c];if(n)r.topicCompleted=!0,V(c);else{let s=-1,o=t.attr("id");if($.each(r.sections,function(g,h){if(h.id===o)return s=g,!1}),s===-1){console.log('completed section"'+o+'"not found');return}let p=r.sections[s];p.completed||(r.sectionsCompleted++,V(c),$(p.jqElement).addClass("done"),p.completed=!0,D(c))}}let S=[];function K(){S.splice(0,S.length),P()}function j(e){let t=S.indexOf(e.id);$(e).is(":visible")?t===-1&&(S.push(e.id),P()):t!==-1&&(S.splice(t,1),P())}function P(){Shiny&&Shiny.setInputValue?Shiny.setInputValue("tutorial-visible-sections",S):$(document).on("shiny:sessioninitialized",function(){Shiny.setInputValue("tutorial-visible-sections",S)})}function Y(e){let t;if(e.length)t=e[0].id;else{console.log("section "+$(e).selector.split('"')[1]+" not found");return}let n=-1;$.each(l,function(i,c){return t===c.id?(n=i,c.topicCompleted=!0,!1):($.each(c.sections,function(r,s){if(t===s.id)return n=i,s.skipped=!0,c.sectionsSkipped++,!1}),n===-1)}),V(n),D(n)}function be(e){let t=0,n=0,i=e.length;for(;n<i;)t=(t<<5)-t+e.charCodeAt(n++)<<0;return t+2147483647+1}function Z(e,t){if(!M)return;let n=$(".parallellayout.col.main"),i=$(".parallellayout.col.side");if(!i.is(":visible")){let o={dontShowAgain:!0};if(config.language==="de"){let p={nextLabel:"Weiter",prevLabel:"Zur\xFCck",doneLabel:"Fertig",stepNumbersOfLabel:"von",dontShowAgainLabel:"Nicht wieder anzeigen"};o=U(U({},o),p)}n.css("flexBasis","100%"),i.css("flexBasis","0%"),i.show(),i.animate({flexBasis:"30%"},{duration:1e3,step:function(p,g){n.css("flexBasis",100-p+"%")},complete:function(){tracking_config.summary&&postEvent(sess,tracking_session_id,sessdata.user_code,"summary_shown"),MathJax.Hub.Queue(["Rerender",MathJax.Hub]),$(".shiny-plot-output").each(()=>Shiny.renderContent(this.id)),introJs().setOptions(o).start()}})}let c=`${e}.${t}`,r=$("#summarytext"),s=null;if(!k.has(c)){let o=$(`.section.level2:eq(${e})  .summary:eq(${t})`),p=o.prevAll(".mainContentElem").first()||o.nextAll(".mainContentElem").first();s=o.prop("id");let g=o.children().detach(),h=null,O=!1;for(let f=0;f<g.length;f++){let m=g[f],X=$(m).hasClass("replace")||o.hasClass("replace"),T=m.tagName==="DIV"?$(m).children():[m];for(let L=0;L<T.length;L++){let B=T[L],y=$(B);if(B.tagName==="H4"){h!==null&&(h.css("opacity","0%").animate({opacity:"100%"},{duration:1e3}),r.append(h));let b="summaryContainer_"+be(y.text());y.on("click",function(){A(e,p.length?p.prop("id"):void 0)}),h=r.find("."+b),h.length===0&&(h=$(`<div class="${b}"></div>`),h.append(y),O=!0)}else h!==null?(X&&h.find(":not(h4)").remove(),h.append(y)):console.error("invalid summary definition (no summary section provided before)");h!==null&&f>=g.length-1&&(h.css("opacity","0%").animate({opacity:"100%"},{duration:1e3}),O&&(r.append(h),O=!1))}}tracking_config.summary&&postEvent(sess,tracking_session_id,sessdata.user_code,"summary_topic_added",{key:c,id:s});let v=r.parent();v.animate({scrollTop:v.prop("scrollHeight")},1e3),k.add(c)}}function I(e){if(!!M)for(let t=0;t<=e;t++){let n=$(`.section.level2:eq(${t})`).find(".summary");for(let i=0;i<n.length;i++)k.has(`${t}.${i}`)||Z(t,i)}}function G(e){let t=Math.floor(e-$(".topicsContainer").height());$(".parallellayout.row").height(t-24)}M&&($(".parallellayout.col.main").scroll(function(){let e=$(`.section.level2:eq(${a})`).find(".summary"),t=$(".bandContent.topicsListContainer").height();e.each(function(i,c){c.getBoundingClientRect().bottom<t&&Z(a,i)});let n=this.scrollHeight-this.clientHeight;this.scrollTop>=n-10&&I(a)}),$(window).on("hashchange",function(){I(a-1)})),$(window).on("resize",function(){G($(this).height())}),ge(),he(),$e(),G($(window).height()),setTimeout(function(){$(".btn-tutorial-run").removeClass("disabled")},5e3),tutorial.onInit(function(){tutorial.onProgress(function(e){e.event==="section_completed"?ve(e.element):e.event==="section_skipped"&&Y(e.element)})})});})();
//# sourceMappingURL=tutorial-format.js.map
